<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEVESOMO –®–∏—Ñ—Ç—ã 2025</title>
    <link rel="stylesheet" href="https://nevesomo.vercel.app/styles.min.css">
    <!-- Telegram Mini‚ÄëApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
window.debugShifts = function() {
    console.log('üîç === –û–¢–õ–ê–î–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø –°–ò–°–¢–ï–ú–´ ===');
    console.log('üë§ currentUser:', window.currentUser);
    console.log('üîß currentMode:', window.currentMode);
    console.log('üì¶ assignments keys:', Object.keys(window.assignments || {}));
    console.log('üë• participants:', window.participants?.length || 0);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π
    const functions = [
        'openBookShiftPopup',
        'openEditShiftPopup', 
        'handleRoleSlotClick',
        'setCurrentUser',
        'renderSchedule'
    ];
    
    functions.forEach(funcName => {
        console.log(`üîß ${funcName}:`, typeof window[funcName]);
    });
};

// –í—ã–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
setTimeout(() => {
    if (window.debugShifts) {
        window.debugShifts();
    }
}, 5000);
</script>
</head>
<body>
    <!-- –ó–∞—Å—Ç–∞–≤–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">
            <img src="https://redloft.ru/wp-content/uploads/veterok.gif" alt="–í–µ—Ç–µ—Ä–æ–∫" class="logo-image">
        </div>
        <div class="loading-content" style="display: none;">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="loading-error" id="loadingError" style="display: none;">
                <div>–°–∏—Å—Ç–µ–º–∞ –∑–∞—Ç—É–ø–∏–ª–∞ üòÖ</div>
                <div>–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω—É: <a href="https://t.me/konovalchik">@konovalchik</a></div>
            </div>
        </div>
    </div>

    <!-- –•–µ–¥–µ—Ä –≤ —Å—Ç–∏–ª–µ Telegram -->
    <!-- –•–µ–¥–µ—Ä –≤ —Å—Ç–∏–ª–µ Telegram -->
    <div class="header">
        <div class="header-left">NEVESOMO</div>
        <div class="header-center">–®–ò–§–¢–´</div>
        <div class="header-right">
            <button class="theme-toggle" onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                üåô
            </button>
            <div class="burger-btn" onclick="toggleMenu()">
                <div class="burger-menu">
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                    <div class="burger-line"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- –ë–æ–ª—å—à–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <h2 id="bigGreeting" class="big-greeting" style="display: none;"></h2>
        
        <div id="deadlineWarning" class="deadline-warning">
            <div>‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–±–µ —à–∏—Ñ—Ç—ã –¥–æ 8 –∏—é–ª—è 2025 –≥–æ–¥–∞ –∏–ª–∏ –º—ã –≤—ã–±–µ—Ä–µ–º –∏—Ö –∑–∞ –≤–∞—Å</div>
            <div class="countdown" id="countdown"></div>
        </div>
        
        <div id="userSelector" class="user-selector">
            <select id="currentUser" onchange="updateView()">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
            </select>
        </div>
        
        <div id="schedule"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ –º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ -->
        <button id="myScheduleBtn" class="my-schedule-btn" onclick="openMySchedule()" style="display: none;">
            –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        </button>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
    <div id="progressBar" class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
    <div id="progressText" class="progress-text"></div>

    <!-- –ú–µ–Ω—é -->
    <div class="menu-overlay" id="menuOverlay" onclick="closeMenu()">
        <div class="menu-content" onclick="event.stopPropagation()">
            <div class="menu-header">
                <div class="menu-title">–ú–µ–Ω—é</div>
                <button class="menu-close" onclick="closeMenu()">√ó</button>
            </div>
            <div id="menuItems"></div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –¥–ª—è –≤—ã–±–æ—Ä–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–∞–¥–º–∏–Ω) -->
    <div class="popup-overlay" id="participantPopup">
        <div class="popup-bottom" onclick="event.stopPropagation()">
            <div class="popup-header">
                <div class="popup-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</div>
                <button class="popup-close" onclick="closeParticipantPopup()">√ó</button>
            </div>
            <div class="popup-body">
                <div id="participantsList"></div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="popup-overlay" id="statsPopup">
        <div class="popup-bottom" onclick="event.stopPropagation()">
            <div class="popup-header">
                <div class="popup-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                <button class="popup-close" onclick="closeStatsPopup()">√ó</button>
            </div>
            <div class="popup-body">
                <div id="statsList"></div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
    <div class="popup-overlay" id="schedulePopup">
        <div class="popup-right" onclick="event.stopPropagation()">
            <div class="popup-header">
                <div class="popup-nav">
                    <button class="popup-back" onclick="closeSchedulePopup()">‚Üê</button>
                    <div class="popup-title">–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
                </div>
                <div class="popup-actions">
                    <button class="popup-close" onclick="closeSchedulePopup()">√ó</button>
                </div>
            </div>
            <div class="popup-body" id="scheduleBody"></div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –æ —à–∏—Ñ—Ç–∞—Ö -->
    <div class="popup-overlay" id="rolesInfoPopup">
        <div class="popup-right" onclick="event.stopPropagation()">
            <div class="popup-header">
                <div class="popup-nav">
                    <button class="popup-back" onclick="closeRolesInfoPopup()">‚Üê</button>
                    <div class="popup-title">–û —à–∏—Ñ—Ç–∞—Ö</div>
                </div>
                <div class="popup-actions">
                    <button class="popup-close" onclick="closeRolesInfoPopup()">√ó</button>
                </div>
            </div>
            <div class="popup-body" id="rolesInfoBody"></div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–æ–ª–∏ -->
    <div class="popup-overlay" id="roleDetailPopup">
        <div class="role-info-popup" onclick="event.stopPropagation()">
            <div class="popup-header">
                <div class="popup-nav">
                    <button class="popup-back" onclick="closeRoleDetailPopup()">‚Üê</button>
                    <div class="popup-title" id="roleDetailTitle">–†–æ–ª—å</div>
                </div>
                <div class="popup-actions">
                    <button class="popup-close" onclick="closeRoleDetailPopup()">√ó</button>
                </div>
            </div>
            <div class="role-image" id="roleDetailImage">üî•</div>
            <div class="popup-body">
                <div class="role-description" id="roleDetailDescription"></div>
                <a href="#" class="role-link" id="roleDetailLink" target="_blank">üìñ –ß–∏—Ç–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</a>
            </div>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ—Å—Ç—É–ø–∞ -->
    <div id="accessOverlay" class="access-block" style="display: none;">
        <p style="font-size: 1.3em; margin-bottom: 8px;">üö´ –î–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç</p>
        <p>–û–±—Ä–∞—Ç–∏—Å—å –∫ –ª–∏–¥—É —à–∏—Ñ—Ç–æ–≤ <a href="https://t.me/konovalchik" target="_blank">@konovalchik</a></p>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="https://nevesomo.vercel.app/airtable.js"></script>
    <script src="https://nevesomo.vercel.app/telegram.js"></script>
    
    <!-- –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="https://nevesomo.vercel.app/data_manager.js"></script>
    <script src="https://nevesomo.vercel.app/ui_renderer.js"></script>
    <script src="https://nevesomo.vercel.app/assignment_logic.js"></script>
    <script src="https://nevesomo.vercel.app/user_manager.js"></script>
    <script src="https://nevesomo.vercel.app/stats_calculator.js"></script>
    <script src="https://nevesomo.vercel.app/popup_manager.js"></script>
    
    <!-- –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª -->
    <script src="https://nevesomo.vercel.app/main.js"></script>
    <footer style="text-align:center; padding:1em 0; font-size: 0.9em; color: #ffffff;     opacity: 0.7;    position: absolute; bottom: 0; left: 0; right: 0; z-index: 9999;">
  ShiftApp <span id="appVersion">2.11</span> ‚ù§Ô∏è 
  <a href="https://www.instagram.com/ikonovalchi/" target="_blank" style="color:#e74c3c; text-decoration: none;">
    IKONOVALCHI
  </a>
</footer>
<!-- –ü–æ–ø–∞–ø –≤–≤–æ–¥–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
<div class="popup-overlay" id="commentPopup">
    <div class="popup-bottom" onclick="event.stopPropagation()">
        <div class="popup-header">
            <div class="popup-title">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —à–∏—Ñ—Ç—É</div>
            <button class="popup-close" onclick="closeCommentPopup()">√ó</button>
        </div>
        <div class="popup-body">
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                –î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Å–≤–æ–µ–º—É —à–∏—Ñ—Ç—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å.
            </p>
            <textarea 
    id="shiftComment" 
    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–ö –ô–æ–≥–∞"
    maxlength="50"
    style="width: 100%; min-height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); resize: none; font-family: inherit; font-size: 1.1rem;"
></textarea>
            <p style="color: var(--text-secondary); font-size: 0.8em; margin-top: 8px;">
                –ú–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —É–¥–∞–ª–∏–≤ –∏ –∑–∞–Ω–æ–≤–æ –≤—ã–±—Ä–∞–≤ —à–∏—Ñ—Ç.
            </p>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button onclick="skipComment()" style="flex: 1; padding: 12px; background: var(--bg-tertiary); border: none; border-radius: 8px; cursor: pointer;">
                    –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                </button>
                <button onclick="saveComment()" style="flex: 1; padding: 12px; background: var(--accent-primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–ø–∞–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div class="popup-overlay" id="confirmPopup">
    <div class="popup-bottom" onclick="event.stopPropagation()">
        <div class="popup-header">
            <div class="popup-title" id="confirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            <button class="popup-close" onclick="closeConfirmPopup()">√ó</button>
        </div>
        <div class="popup-body" style="text-align: center; padding: 32px 20px;">
            <div id="confirmMessage" style="font-size: 1.1em; margin-bottom: 24px;"></div>
            <div style="display: flex; gap: 16px;">
                <button onclick="closeConfirmPopup()" style="flex: 1; padding: 14px; background: var(--bg-tertiary); border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button id="confirmAction" style="flex: 1; padding: 14px; background: var(--error-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

    <!-- –ü–æ–ø–∞–ø –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à–∏—Ñ—Ç–∞ -->
<div class="popup-overlay" id="bookShiftPopup">
    <div class="popup-bottom" onclick="event.stopPropagation()">
        <div class="popup-header">
            <div class="popup-title" id="bookTitle">–ó–∞–Ω—è—Ç—å —à–∏—Ñ—Ç?</div>
            <button class="popup-close" onclick="closeBookShiftPopup()">√ó</button>
        </div>
        <div class="popup-body">
            <div id="bookRoleInfo" style="font-weight: 500; margin-bottom: 16px; color: var(--accent-primary);"></div>
            <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 0.9em;">
                –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            </p>
            <textarea 
                id="bookComment" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–ö –ô–æ–≥–∞"
                maxlength="50"
                style="width: 100%; min-height: 40px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); resize: none; font-family: inherit; font-size: 1rem;"
            ></textarea>
            <p style="color: var(--text-secondary); font-size: 0.8em; margin-top: 8px;">
                –ú–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º.
            </p>
            <div style="margin-top: 20px;">
                <button onclick="confirmBookShift()" style="width: 100%; padding: 16px; background: var(--accent-primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1.1em;">
                    –ó–∞–Ω—è—Ç—å!
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–ø–∞–ø —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∏—Ñ—Ç–∞ -->
<div class="popup-overlay" id="editShiftPopup">
    <div class="popup-bottom" onclick="event.stopPropagation()">
        <div class="popup-header">
            <div class="popup-title" id="editTitle">–î–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ç–∞</div>
            <button class="popup-close" onclick="closeEditShiftPopup()">√ó</button>
        </div>
        <div class="popup-body">
            <div id="editRoleInfo" style="font-weight: 500; margin-bottom: 16px; color: var(--accent-primary);"></div>
            <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 0.9em;">
                –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            </p>
            <textarea 
                id="editComment" 
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–ö –ô–æ–≥–∞"
                maxlength="50"
                oninput="onEditCommentChange()"
                style="width: 100%; min-height: 80px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-primary); resize: none; font-family: inherit; font-size: 1rem;"
            ></textarea>
            <input type="hidden" id="editOriginalComment">
            <p style="color: var(--text-secondary); font-size: 0.8em; margin-top: 8px;">
                –ú–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤.
            </p>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button onclick="closeEditShiftPopup()" style="flex: 1; padding: 12px; background: var(--bg-tertiary); border: none; border-radius: 8px; cursor: pointer;">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button id="editActionBtn" style="flex: 1; padding: 12px; background: var(--error-color); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
                    –û—Å–≤–æ–±–æ–¥–∏—Ç—å —à–∏—Ñ—Ç
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
